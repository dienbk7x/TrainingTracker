<% content_for :grid do %>
  container-fluid
<% end %>

<% script = '' %>

<h1><%= @department.display_name %> - Training</h1>

<table class='bordered-table'>
  <thead>
    <tr>
      <th></th>
      <% @employees.each do |employee| %>
        <th class='employee_column' style="text-align: center;">
			<%= link_to employee.username, employee, :title => employee.full_name, :rel => 'twipsy' %>
		</th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @departments.each do |dept| %>
      <tr>
        <th class='left' style='background-color:#eee;' colspan='<%= @employees.count + 1 %>'><a href="<%= trainings_path %>/grid/<%= dept.id %>"><%= dept.display_name %></th>
      </tr>
      <% dept.documents.each do |document| %>
        <tr>
          <td><%= link_to document.number, document, :title => document.name, :rel => 'twipsy', 'data-placement' => 'right' %></td>
          <% @employees.each do |employee| %>
            <td id='<%= "d#{document.id}_e#{employee.id}" %>' style="text-align: center;">
			<% i=0 %>
			<% document.trainings.each do |training| %>
              <% if training.employee.id == employee.id %>
                <span class="label <%= training.status[:class] %>"><%= link_to training.status[:name], training, :title => "#{training.status[:name]} | #{training.trained_on}", :rel => 'twipsy' %></span>
				<% script << "$('#d#{document.id}_e#{employee.id}').addClass('#{training.status[:class]}'); \n" %>
				<% i+=1 %>
			  <% end %>
            <% end %>

			<% if(i == 0 || document.trainings.count == 0 ) %>
				<span class="label"><%= link_to 'No Training', new_training_path(:employee => employee.id, :document => document.id) %></span>
			<% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
    <% end %>
  </tbody>
  <tfoot>
    <tr>
      <td colspan='<%= @employees.count + 1 %>' style='text-align: right; background-color:#eee;'><%= link_to 'New Training', new_training_path %></td>
    </tr>
  </tfoot>
</table>


<script>
	<%= script %>
</script>