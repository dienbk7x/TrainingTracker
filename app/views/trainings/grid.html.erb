<style>
	.left {
		text-align: left;
	}
</style>

<% script = '' %>
<h1><%= @department.name %> Training</h1>

<table class='grid' border='1'>
  <thead>
    <tr>
      <th></th>
      <% @employees.each do |employee| %>
        <th class='employee_column'><%= employee.username %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @document_groups.each do |document_group| %>
      <tr>
        <th class='left' colspan='<%= @employees.count + 1 %>'><%= document_group.name %></th>
      </tr>
      <% document_group.documents.each do |document| %>
        <tr>
          <td><%= document.full_name %></td>
          <% @employees.each do |employee| %>
            <td id='<%= "d#{document.id}_e#{employee.id}" %>'>
            <% document.trainings.each do |training| %>
              <% if training.employee.id == employee.id %>
                <%= link_to (training.trained_on ? training.trained_on : 'Not Trained'), training %>
				<% script << "$('#d#{document.id}_e#{employee.id}').css('backgroundColor', '##{training.status.color}'); \n" %>
              <% end %>
            <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
      <tr>
        <td colspan='<%= @employees.count + 1 %>'></td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= javascript_include_tag("flexigrid") %>
<script>
	<%= script %>
	
	//$('.grid').flexigrid();
</script>
		
<br />

<%= link_to 'New Training', new_training_path %>

<table>
  <thead>
    <tr>
      <th>Legend</th>
    </tr>
  </thead>
  <tbody>
    <% @statuses.each do |status| %>
    <tr style="background-color: #<%= status.color %>">
      <td><%= status.name %></td>
    </tr>
    <% end %>
  </tbody>
</table>